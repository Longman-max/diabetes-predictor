<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home | Diabetes Predictor</title>
    <link rel="stylesheet" href="../static/css/style.css" />
    <link rel="stylesheet" href="../static/css/dark-mode.css" />
    <link
      rel="shortcut icon"
      href="../static/images/logo.jpeg"
      type="image/x-icon"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined&display=swap"
    />
    <style>
      /* Responsive menu bar for mobile */
      @media (max-width: 600px) {
        .header-actions {
          display: none !important;
        }
        .mobile-menu {
          display: none; /* Only shown by JS */
          flex-direction: column;
          align-items: flex-start;
          gap: 0;
          overflow: hidden;
          height: 0;
          transition: height 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .menu-btn {
          display: block !important;
        }
        /* Make dropdown flow in menu for height animation */
        .simulate-dropdown-wrapper-mobile #simulate-dropdown-mobile {
          position: static !important;
          width: 100% !important;
          margin: 0;
          display: none;
          background: #fff;
          border: 1px solid #ccc;
          border-radius: 8px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
          z-index: 1;
          min-width: 160px;
        }
        .simulate-dropdown-wrapper-mobile.open #simulate-dropdown-mobile {
          display: block;
        }
      }
      @media (min-width: 601px) {
        .header-actions {
          display: flex !important;
        }
        .mobile-menu {
          display: none !important;
        }
        .menu-btn {
          display: none !important;
        }
      }
    </style>
    <script>
      alert("App is still under development. Some features may not work as expected.");
    </script>
  </head>
  <body>
    <header>
      <div class="header-main">
        <div class="header-left">
          <div class="pk-logo">
            <img src="../static/images/logo.jpeg" alt="Logo" />
          </div>
          <h1 style="margin: 0">Precious Kings</h1>
        </div>
        <div class="header-actions" id="header-actions">
          <button
            type="button"
            id="simulate-btn"
            class="simulate-btn"
            style="display: flex; align-items: center; gap: 6px; cursor: pointer;"
          >
            <span style="color: #111">Simulate</span>
            <span class="material-symbols-outlined" style="font-size: 24px; color: #111;">casino</span>
          </button>
          <button
            type="button"
            id="theme-toggle"
            class="theme-btn"
            aria-label="Toggle dark mode"
            style="display: flex; align-items: center; gap: 6px; cursor: pointer; background: none; border: none; padding: 8px; border-radius: 8px;"
          >
            <span class="material-symbols-outlined" style="font-size: 24px; color: #111;">dark_mode</span>
          </button>
          <a href="/about" class="about-btn">About</a>
        </div>
        <div
          class="mobile-menu"
          id="mobile-menu"
          style="
            display: none;
            flex-direction: column;
            align-items: flex-start;
            gap: 0;
            height: 0;
            overflow: hidden;
          "
        >
          <button
            type="button"
            id="simulate-btn-mobile"
            class="simulate-btn"
            style="
              width: 100%;
              display: flex;
              align-items: center;
              gap: 6px;
              cursor: pointer;
            "
          >
            <span style="color: #111">Simulate</span>
            <span
              class="material-symbols-outlined"
              style="font-size: 28px; color: #111; line-height: 1"
              >casino</span
            >
          </button>
          <a
            href="/about"
            class="about-btn"
            style="width: 100%; margin-top: 4px"
            >About</a
          >
        </div>
        <button class="menu-btn" id="menu-btn" type="button">
          <span class="material-symbols-outlined">menu</span>
        </button>
      </div>
    </header>

    <h1>Diabetes Predictor</h1>

    <div class="two-column">
      <!-- Form -->
      <div class="form-box">
        <form action="/predict" method="post">
          <h3>Medical Information</h3>
          <div class="form-grid">
            <div class="form-group">
              <label for="Age">Age: <span class="clinical-range">(10-100)</span> </label>
              <input type="number" name="Age" required />
            </div>
            <div class="form-group">
              <label for="BMI">BMI: <span class="clinical-range">(10-60)</span> </label>
              <input type="number" step="0.1" name="BMI" required />
            </div>
            <div class="form-group">
              <label for="Blood Glucose">Blood Glucose: <span class="clinical-range">(50-800)</span></label>
              <input type="number" name="Blood Glucose" required />
            </div>
            <div class="form-group">
              <label for="Blood Pressure">Blood Pressure: <span class="clinical-range">(80-200) </label>
              <input type="number" name="Blood Pressure" required />
            </div>
            <div class="form-group">
              <label for="HbA1c">HbA1c: <span class="clinical-range">(4.0-14.0) </label>
              <input type="number" step="0.1" name="HbA1c" required />
            </div>
            <div class="form-group">
              <label for="Insulin Level">Insulin Level: <span class="clinical-range">(2-300) </label>
              <input type="number" name="Insulin Level" required />
            </div>
            <div class="form-group">
              <label for="Skin thickness">Skin thickness: <span class="clinical-range">(7-100) </label>
              <input type="number" name="Skin thickness" required />
            </div>

            <!-- The rest of the fields are now optional -->
            <div class="form-group">
              <label for="Pregnancies"
                >Pregnancies: <span class="clinical-range">(0–17)</span></label
              >
              <input
                type="number"
                name="Pregnancies"
                id="Pregnancies"
                min="0"
                max="17"
              />
              <span class="error-message" id="error-Pregnancies"></span>
            </div>
            <div class="form-group">
              <label for="Family history"
                >Family History:
                <span class="clinical-range">(Yes/No)</span></label
              >
              <select name="Family history" id="Family-history">
                <option value="">Select</option>
                <option value="0">No</option>
                <option value="1">Yes</option>
              </select>
              <span class="error-message" id="error-Family-history"></span>
            </div>
            <div class="form-group">
              <label for="Physical Activity"
                >Physical Activity:
                <span class="clinical-range">(Low/Medium/High)</span></label
              >
              <select name="Physical Activity" id="Physical-Activity">
                <option value="">Select</option>
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
              </select>
              <span class="error-message" id="error-Physical-Activity"></span>
            </div>
            <div class="form-group">
              <label for="Smoking status"
                >Smoking Status:
                <span class="clinical-range">(Smoker/Non-Smoker)</span></label
              >
              <select name="Smoking status" id="Smoking-status">
                <option value="">Select</option>
                <option value="Smoker">Smoker</option>
                <option value="Non-Smoker">Non-Smoker</option>
              </select>
              <span class="error-message" id="error-Smoking-status"></span>
            </div>
            <div class="form-group">
              <label for="Alcohol Intake"
                >Alcohol Intake (drinks/week):
                <span class="clinical-range">(0–30)</span></label
              >
              <input
                type="number"
                name="Alcohol Intake"
                id="Alcohol-Intake"
                min="0"
                max="30"
              />
              <span class="error-message" id="error-Alcohol-Intake"></span>
            </div>
            <div class="form-group">
              <label for="Diet Qualtiy"
                >Diet Quality (servings/day):
                <span class="clinical-range">(0–10)</span></label
              >
              <input
                type="number"
                name="Diet Qualtiy"
                id="Diet-Qualtiy"
                min="0"
                max="10"
              />
              <span class="error-message" id="error-Diet-Qualtiy"></span>
            </div>
            <div class="form-group">
              <label for="Cholesterol"
                >Cholesterol (mg/dL):
                <span class="clinical-range">(100–400)</span></label
              >
              <input
                type="number"
                name="Cholesterol"
                id="Cholesterol"
                min="100"
                max="400"
              />
              <span class="error-message" id="error-Cholesterol"></span>
            </div>
            <div class="form-group">
              <label for="Triglycerides"
                >Triglycerides (mg/dL):
                <span class="clinical-range">(50–500)</span></label
              >
              <input
                type="number"
                name="Triglycerides"
                id="Triglycerides"
                min="50"
                max="500"
              />
              <span class="error-message" id="error-Triglycerides"></span>
            </div>
            <div class="form-group">
              <label for="Waiste ratio"
                >Waist Circumference (cm):
                <span class="clinical-range">(60–150)</span></label
              >
              <input
                type="number"
                name="Waiste ratio"
                id="Waiste-ratio"
                min="60"
                max="150"
              />
              <span class="error-message" id="error-Waiste-ratio"></span>
            </div>
          </div>

          <button type="submit">Predict</button>
        </form>
      </div>

      <!-- Prediction Result -->
      <div class="prediction-box" id="result">
        <h3>Prediction Result</h3>
        {% with messages = get_flashed_messages() %} {% if messages %}
        <p class="status" id="status-text">Prediction complete</p>
        <div class="progress-bar">
          <span id="progress-bar-span" style="width: 100%"></span>
        </div>
        <div class="health-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-briefcase-medical-icon lucide-briefcase-medical">
            <path d="M12 11v4"/>
            <path d="M14 13h-4"/>
            <path d="M16 6V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/>
            <path d="M18 6v14"/>
            <path d="M6 6v14"/>
            <rect width="20" height="14" x="2" y="6" rx="2"/>
          </svg>
        </div>
        <p class="result-text final" id="result-text">{{ messages[0] }}</p>
        <p class="instruction-text">
          Enter your medical information and click "Predict" to see your
          diabetes risk assessment.
        </p>
        <button type="button" id="clear-result-btn">Clear Result</button>
        {% else %}
        <p class="status" id="status-text">Awaiting result...</p>
        <div class="progress-bar">
          <span id="progress-bar-span" style="width: 0%"></span>
        </div>
        <div class="health-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-briefcase-medical-icon lucide-briefcase-medical">
            <path d="M12 11v4"/>
            <path d="M14 13h-4"/>
            <path d="M16 6V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/>
            <path d="M18 6v14"/>
            <path d="M6 6v14"/>
            <rect width="20" height="14" x="2" y="6" rx="2"/>
          </svg>
        </div>
        <p class="result-text" id="result-text">No prediction yet</p>
        <p class="instruction-text">
          Enter your medical information and click "Predict" to see your
          diabetes risk assessment.
        </p>
        <button type="button" id="clear-result-btn">Clear Result</button>
        {% endif %} {% endwith %}
      </div>
    </div>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
  var clearBtn = document.getElementById("clear-result-btn");
  if (clearBtn) {
    clearBtn.addEventListener("click", function () {
      document.getElementById("status-text").textContent = "Awaiting result...";
      document.getElementById("progress-bar-span").style.width = "0%";
      document.getElementById("progress-bar-span").style.animation = "";
      document.getElementById("result-text").textContent = "No prediction yet";
      updateHealthIcon("none"); // Reset icon
    });
  }

  // Function to update health icon based on risk level
  function updateHealthIcon(risk) {
    const healthIcon = document.querySelector('.health-icon');
    if (!healthIcon) return;

    // Remove any existing risk classes
    healthIcon.classList.remove('high-risk', 'medium-risk', 'low-risk');

    // Define the SVG based on risk level
    const medicalBriefcaseSVG = `<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-briefcase-medical-icon lucide-briefcase-medical">
            <path d="M12 11v4"/>
            <path d="M14 13h-4"/>
            <path d="M16 6V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/>
            <path d="M18 6v14"/>
            <path d="M6 6v14"/>
            <rect width="20" height="14" x="2" y="6" rx="2"/>
          </svg>`;

    const alertTriangleSVG = `<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-triangle-alert-icon lucide-triangle-alert">
            <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"/>
            <path d="M12 9v4"/>
            <path d="M12 17h.01"/>
          </svg>`;

    // Update icon and class based on risk level
    if (risk === "high") {
      healthIcon.innerHTML = alertTriangleSVG;
      healthIcon.classList.add('high-risk');
    } else if (risk === "medium") {
      healthIcon.innerHTML = alertTriangleSVG;
      healthIcon.classList.add('medium-risk');
    } else {
      healthIcon.innerHTML = medicalBriefcaseSVG;
      healthIcon.classList.add('low-risk');
    }
  }

  // Check prediction result when available
  const resultText = document.getElementById('result-text');
  if (resultText && resultText.textContent !== "No prediction yet") {
    const text = resultText.textContent.toLowerCase();
    if (text.includes('high risk') || text.includes('high likelihood')) {
      updateHealthIcon('high');
    } else if (text.includes('medium risk') || text.includes('moderate')) {
      updateHealthIcon('medium');
    } else if (text.includes('low risk') || text.includes('unlikely')) {
      updateHealthIcon('low');
    }
  }
});
// Validation logic
const form = document.querySelector("form");
form.addEventListener("submit", function (e) {
  let valid = true;
  // Pregnancies
  const preg = document.getElementById("Pregnancies");
  if (preg.value === "" || preg.value < 0 || preg.value > 17) {
    document.getElementById("error-Pregnancies").textContent = "Enter 0–17";
    valid = false;
  } else {
    document.getElementById("error-Pregnancies").textContent = "";
  }
  // Family History
  const fam = document.getElementById("Family-history");
  if (fam.value === "") {
    document.getElementById("error-Family-history").textContent =
      "Select Yes or No";
    valid = false;
  } else {
    document.getElementById("error-Family-history").textContent = "";
  }
  // Physical Activity
  const pa = document.getElementById("Physical-Activity");
  if (pa.value === "") {
    document.getElementById("error-Physical-Activity").textContent =
      "Select activity";
    valid = false;
  } else {
    document.getElementById("error-Physical-Activity").textContent = "";
  }
  // Smoking Status
  const smoke = document.getElementById("Smoking-status");
  if (smoke.value === "") {
    document.getElementById("error-Smoking-status").textContent =
      "Select status";
    valid = false;
  } else {
    document.getElementById("error-Smoking-status").textContent = "";
  }
  // Alcohol Intake
  const alcohol = document.getElementById("Alcohol-Intake");
  if (alcohol.value === "" || alcohol.value < 0 || alcohol.value > 30) {
    document.getElementById("error-Alcohol-Intake").textContent =
      "0–30 drinks/week";
    valid = false;
  } else {
    document.getElementById("error-Alcohol-Intake").textContent = "";
  }
  // Diet Quality
  const diet = document.getElementById("Diet-Qualtiy");
  if (diet.value === "" || diet.value < 0 || diet.value > 10) {
    document.getElementById("error-Diet-Qualtiy").textContent =
      "0–10 servings/day";
    valid = false;
  } else {
    document.getElementById("error-Diet-Qualtiy").textContent = "";
  }
  // Cholesterol
  const chol = document.getElementById("Cholesterol");
  if (chol.value === "" || chol.value < 100 || chol.value > 400) {
    document.getElementById("error-Cholesterol").textContent = "100–400 mg/dL";
    valid = false;
  } else {
    document.getElementById("error-Cholesterol").textContent = "";
  }
  // Triglycerides
  const trig = document.getElementById("Triglycerides");
  if (trig.value === "" || trig.value < 50 || trig.value > 500) {
    document.getElementById("error-Triglycerides").textContent = "50–500 mg/dL";
    valid = false;
  } else {
    document.getElementById("error-Triglycerides").textContent = "";
  }
  // Waist Circumference
  const waist = document.getElementById("Waiste-ratio");
  if (waist.value === "" || waist.value < 60 || waist.value > 150) {
    document.getElementById("error-Waiste-ratio").textContent = "60–150 cm";
    valid = false;
  } else {
    document.getElementById("error-Waiste-ratio").textContent = "";
  }
  if (!valid) e.preventDefault();
});
// Simulate random input button logic
// (Removed simulate-btn click handler to avoid conflict with dropdown)
// Dropdown for simulate button (hover to show, closes on mouseleave/outside click)
const simulateBtn = document.getElementById("simulate-btn");
const dropdown = document.getElementById("simulate-dropdown");
const simulateBtnWrapper = simulateBtn.parentElement;
// Remove JS show/hide for dropdown, keep only click actions
function fillFields(riskLevel) {
  // Helper function to get random number within range
  const getRandomInRange = (min, max, decimals = 0) => {
    const num = Math.random() * (max - min) + min;
    return decimals ? Number(num.toFixed(decimals)) : Math.floor(num);
  };

  let values = {};
  
  switch(riskLevel) {
    case 'no':
      values = {
        Age: getRandomInRange(18, 30),
        BMI: getRandomInRange(18.5, 24.9, 1),
        'Blood Glucose': getRandomInRange(70, 99), // Normal range
        'Blood Pressure': getRandomInRange(80, 120), // Normal range
        'HbA1c': getRandomInRange(4.0, 5.6, 1), // Normal range
        'Insulin Level': getRandomInRange(2, 100), // Normal range
        'Skin thickness': getRandomInRange(7, 30),
        Pregnancies: getRandomInRange(0, 1),
        'Family history': "0",
        'Physical Activity': "High",
        'Smoking status': "Non-Smoker",
        'Alcohol Intake': getRandomInRange(0, 5),
        'Diet Qualtiy': getRandomInRange(7, 10),
        Cholesterol: getRandomInRange(100, 150),
        Triglycerides: getRandomInRange(80, 150),
        // 'Waiste ratio': getRandomInRange(60, 80), // In cm
        'Waist ratio': getRandomInRange(60, 80) // Try both spellings to ensure it works
      };
      break;
    
    case 'low':
      values = {
        Age: getRandomInRange(25, 45),
        BMI: getRandomInRange(25, 29.9, 1),
        'Blood Glucose': getRandomInRange(100, 125), // Prediabetes range
        'Blood Pressure': getRandomInRange(70, 85),
        'HbA1c': getRandomInRange(5.7, 6.0, 1), // Prediabetes range
        'Insulin Level': getRandomInRange(120, 140),
        'Skin thickness': getRandomInRange(25, 35),
        Pregnancies: getRandomInRange(0, 2),
        'Family history': Math.random() > 0.7 ? "1" : "0",
        'Physical Activity': "Medium",
        'Smoking status': "Non-Smoker",
        'Alcohol Intake': getRandomInRange(5, 10),
        'Diet Qualtiy': getRandomInRange(5, 7),
        Cholesterol: getRandomInRange(150, 200),
        Triglycerides: getRandomInRange(150, 200),
        'Waiste ratio': getRandomInRange(0.9, 1.0)
      };
      break;

    case 'moderate':
      values = {
        Age: getRandomInRange(45, 60),
        BMI: getRandomInRange(30, 35, 1),
        'Blood Glucose': getRandomInRange(126, 150), // Diabetic range
        'Blood Pressure': getRandomInRange(130, 160),
        'HbA1c': getRandomInRange(6.1, 6.9, 1),
        'Insulin Level': getRandomInRange(150, 200),
        'Skin thickness': getRandomInRange(40, 70),
        Pregnancies: getRandomInRange(1, 3),
        'Family history': "1",
        'Physical Activity': "Low",
        'Smoking status': Math.random() > 0.5 ? "Smoker" : "Non-Smoker",
        'Alcohol Intake': getRandomInRange(10, 20),
        'Diet Qualtiy': getRandomInRange(3, 5),
        Cholesterol: getRandomInRange(200, 250),
        Triglycerides: getRandomInRange(200, 250),
        'Waiste ratio': getRandomInRange(100, 120) // In cm
      };
      break;

    case 'high':
      values = {
        Age: getRandomInRange(50, 80),
        BMI: getRandomInRange(35, 40, 1),
        'Blood Glucose': getRandomInRange(150, 200), // High diabetic range
        'Blood Pressure': getRandomInRange(160, 200),
        'HbA1c': getRandomInRange(7.0, 12.0, 1), // High diabetic range
        'Insulin Level': getRandomInRange(200, 300),
        'Skin thickness': getRandomInRange(70, 100),
        Pregnancies: getRandomInRange(2, 5),
        'Family history': "1",
        'Physical Activity': "Low",
        'Smoking status': "Smoker",
        'Alcohol Intake': getRandomInRange(20, 30),
        'Diet Qualtiy': getRandomInRange(0, 3),
        Cholesterol: getRandomInRange(250, 300),
        Triglycerides: getRandomInRange(250, 300),
        'Waiste ratio': getRandomInRange(120, 150) // Match exact field name from form
      };
      break;

    default: // random - keeps full range but weighted towards middle
      const weights = [0.1, 0.25, 0.3, 0.25, 0.1]; // weights for different ranges
      const rand = Math.random();
      let range;
      
      if (rand < weights[0]) range = 'no';
      else if (rand < weights[0] + weights[1]) range = 'low';
      else if (rand < weights[0] + weights[1] + weights[2]) range = 'moderate';
      else if (rand < weights[0] + weights[1] + weights[2] + weights[3]) range = 'high';
      else range = 'very_high';
      
      // Recursively call with selected range
      return fillFields(range === 'very_high' ? 'high' : range);
  }

  // Fill in the form fields
  Object.entries(values).forEach(([key, value]) => {
    const element = document.querySelector(`input[name="${key}"]`) || document.getElementById(`${key.replace(/\s+/g, '-')}`);
    if (element) element.value = value;
  });
}

function scrollToPredict() {
  var predictBtn = document.querySelector('form button[type="submit"]');
  if (predictBtn) {
    predictBtn.scrollIntoView({ behavior: "smooth", block: "center" });
    predictBtn.focus();
  }
}

// Set up simulation button handlers
document.getElementById("simulate-btn").onclick = () => {
  fillFields('random');
  scrollToPredict();
};
document.getElementById("simulate-btn-mobile").onclick = () => {
  fillFields('random');
  scrollToPredict();
  document.getElementById('mobile-menu').classList.remove('show');
};
// CSS fix for dropdown z-index and overflow
const style = document.createElement("style");
style.innerHTML = `
        #simulate-dropdown { z-index: 9999 !important; }
        .header-main, .header-actions { overflow: visible !important; }
      `;
document.head.appendChild(style);      // Mobile menu functionality
    const menuBtn = document.getElementById('menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');

    if (menuBtn && mobileMenu) {
      menuBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('show');
      });

      // Close menu when clicking outside
      document.addEventListener('click', (e) => {
        if (!mobileMenu.contains(e.target) && !menuBtn.contains(e.target)) {
          mobileMenu.classList.remove('show');
        }
      });
    }
  </script>
    <script src="../static/js/theme.js"></script>
  </body>
</html>